{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                Navigation
            </div>
            <div class="list-group list-group-flush">
                <a href="{% url 'dashboard' %}" class="list-group-item list-group-item-action active">Dashboard</a>
                <a href="{% url 'allsales' %}" class="list-group-item list-group-item-action">View All Sales</a>
                <a href="{% url 'allstock' %}" class="list-group-item list-group-item-action">View Stock</a>
                
                <a href="{% url 'addcredit' %}" class="list-group-item list-group-item-action">View Credits</a>
                <a href="{% url 'logout' %}" class="list-group-item list-group-item-action">Logout</a>
            </div>
        </div>
    </div>
    <div class="col-md-9">
        <h1>Manager Dashboard - {{ branch_name }}</h1>
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Branch Sales</h2>
                        <p>Total Sales for this Branch: {{ branch_sales }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Branch Stock</h2>
                        <ul>
                            {% for item in branch_stock %}
                            <li>{{ item.name_of_produce }} - Tonnage: {{ item.tonnage }}</li>
                            {% empty %}
                            <li>No stock available in this branch.</li>
                            {% endfor %}
                        </ul>
                        {% if low_stock_items %}
                        <h6 class="mt-2 text-warning">Low Stock Items:</h6>
                        <ul>
                            {% for item in low_stock_items %}
                            <li>{{ item.name_of_produce }} - Tonnage: {{ item.tonnage }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Sales Agent Performance</h2>
                        <ul>
                            {% for agent_data in sales_agent_sales_data %}
                            <li>{{ agent_data.agent_name }}: {{ agent_data.total_sales }}</li>
                            {% empty %}
                            <li>No sales agents assigned to this branch.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Branch Credits</h2>
                        <ul>
                            {% for credit in branch_credits %}
                            <li>Buyer: {{credit.buyer_name}} - Amount Due: {{credit.amount_due}} - Due Date: {{credit.due_date}}</li>
                            {% empty %}
                            <li>No outstanding credits for this branch.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Recent Branch Sales</h2>
                        {% if recent_branch_sales %}
                        <ul>
                            {% for sale in recent_branch_sales %}
                            <li>{{ sale.name_of_produce }} - Quantity: {{ sale.tonnage }} - Price: {{ sale.selling_price }} - Date: {{ sale.date_and_time }}</li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p>No recent sales.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
{{ block.super }}
<style>
    .list-group-item.active {
        background-color: #3498db;
        border-color: #3498db;
        color: white;
    }
    .list-group-item:hover {
        background-color: #f0f0f0;
    }
</style>
{% endblock %}