{% extends 'base.html' %}
{% load static %}

{% block title %}Sales Agent Dashboard{% endblock %}

{% block content %}
<!-- FIX: Added Lucide CDN import here. It defines the 'lucide' object needed below. -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Main Container: Background color matching KGL Manager Dashboard: #f4f7f9 -->
<div class="p-4 sm:p-8 bg-[#f4f7f9] min-h-screen">
    <div class="max-w-6xl mx-auto">
        
        <!-- Welcome Header: Matches the clean white header of the Manager Dashboard -->
        <header class="bg-white p-6 rounded-2xl shadow-xl mb-8">
            <div class="flex items-center justify-between">
                <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                    <i data-lucide="user-circle" class="w-7 h-7 mr-3 text-blue-500"></i>
                    Agent Dashboard
                </h1>
                <span class="text-gray-600 hidden sm:block text-lg">Welcome, {{ request.user.username }}!</span>
            </div>
        </header>
        
        <!-- Dashboard Grid: Top Row (2 columns on desktop, 1 on mobile) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            
            <!-- Card 1: Total Sales - Focus Stat (Using Blue Accent for Primary Metric) -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border-l-4 border-blue-500 transition hover:shadow-xl duration-300">
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-500 font-medium">Your Total Sales Generated</p>
                    <i data-lucide="trending-up" class="w-7 h-7 text-blue-500"></i>
                </div>
                <div class="text-4xl font-extrabold text-gray-900 mt-2">
                    UGX {{ total_sales|default:"0"|floatformat:2 }}
                </div>
                <p class="text-gray-500 text-xs mt-1">All-time revenue credited to your account.</p>
            </div>
            
            <!-- Card 2: Stock Summary (Using Indigo Accent for Inventory) -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border-l-4 border-indigo-500 transition hover:shadow-xl duration-300">
                 <div class="flex justify-between items-center mb-4">
                    <p class="text-sm text-gray-500 font-medium">Current Total Stock</p>
                    <i data-lucide="package-search" class="w-7 h-7 text-indigo-500"></i>
                </div>
                
                {% if total_stock %}
                    <div class="text-4xl font-extrabold text-gray-900 mb-2">{{ total_stock }} Kgs</div>
                    
                    {% if low_stock_products %}
                        <!-- Low Stock Alert (Red/Warning) -->
                        <div class="bg-red-50 border border-red-400 text-red-700 p-3 rounded-xl flex items-start text-sm shadow-inner mt-4">
                            <i data-lucide="alert-triangle" class="w-5 h-5 mr-3 mt-0.5 flex-shrink-0"></i>
                            <div>
                                <strong class="font-bold block mb-1">Low Stock Alert:</strong>
                                <span class="block text-xs">
                                    {% for product in low_stock_products %}
                                        {{ product.name_of_produce }} ({{ product.tonnage }}kg){% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </span>
                            </div>
                        </div>
                    {% else %}
                        <!-- Success Alert (Green) -->
                        <div class="bg-green-50 border border-green-300 text-green-700 p-3 rounded-xl flex items-center text-sm shadow-inner mt-4">
                            <i data-lucide="check-circle" class="w-5 h-5 mr-3"></i>
                            Stock levels are looking healthy.
                        </div>
                    {% endif %}
                {% else %}
                    <p class="text-gray-500 text-sm mt-4">No stock information available.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Dashboard Grid: Bottom Row (2 columns on desktop, 1 on mobile) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Card 3: Recent Sales List (Using Green Accent for Cash Inflow) -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-l-4 border-green-500 transition hover:shadow-xl duration-300">
                <div class="bg-white text-gray-800 p-4 border-b border-gray-100 flex items-center font-semibold">
                    <i data-lucide="clock" class="w-5 h-5 mr-3 text-green-600"></i> Recent Sales Activity
                </div>
                <div class="p-0">
                    {% if recent_sales %}
                        <ul class="divide-y divide-gray-100">
                            {% for sale in recent_sales %}
                                <li class="flex justify-between items-center p-4 hover:bg-gray-50 transition duration-150">
                                    <span class="font-medium text-slate-700">{{ sale.product_name }}</span>
                                    <div class="text-right">
                                        <span class="text-green-600 font-bold block text-base">UGX {{ sale.total_sales|floatformat:2 }}</span>
                                        <small class="text-gray-400 text-xs">{{ sale.date_and_time|date:"d M Y, H:i" }}</small>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-gray-500 p-6 text-sm">No recent sales recorded.</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Card 4: Recent Credit Issued List (Using Yellow Accent for Outstanding Debt) -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-l-4 border-yellow-500 transition hover:shadow-xl duration-300">
                <div class="bg-white text-gray-800 p-4 border-b border-gray-100 flex items-center font-semibold">
                    <i data-lucide="wallet" class="w-5 h-5 mr-3 text-yellow-600"></i> Recent Credit Issued
                </div>
                <div class="p-0">
                    {% if recent_credit %}
                        <ul class="divide-y divide-gray-100">
                            {% for credit_entry in recent_credit %}
                                <li class="flex justify-between items-center p-4 hover:bg-gray-50 transition duration-150">
                                    <span class="font-medium text-slate-700">{{ credit_entry.buyer_name }}</span>
                                    <div class="text-right">
                                        <!-- Using red-600 for money owed/due, but the card accent is yellow-500 -->
                                        <span class="text-red-600 font-bold block text-base">UGX {{ credit_entry.amount_due|floatformat:2 }} Due</span>
                                        <small class="text-gray-400 text-xs">Dispatch Date: {{ credit_entry.Dispatch_date|date:"d M Y" }}</small>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-gray-500 p-6 text-sm">No recent credit issued.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Initialize Lucide icons
    lucide.createIcons();
</script>
{% endblock %}
